<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Client Hints Infrastructure</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version bf22245b8, updated Tue Apr 18 15:53:37 2023 -0700" name="generator">
  <link href="https://wicg.github.io/client-hints-infrastructure" rel="canonical">
  <meta content="96a82dfdc159dc220ae02017937df45075722e97" name="document-revision">
<style>
table, th, td { border: 1px black solid; }
thead {background-color: yellow; }
</style>
<style>/* style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}
</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}
</style>
<style>/* style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Client Hints Infrastructure</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2023-04-26">26 April 2023</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/client-hints-infrastructure">https://wicg.github.io/client-hints-infrastructure</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/client-hints-infrastructure/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://blog.yoav.ws">Yoav Weiss</a> (<span class="p-org org">Google</span>) <a class="u-email email" href="mailto:yoav@yoav.ws">yoav@yoav.ws</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 the Contributors to the Client Hints Infrastructure Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Specification of the Client Hints infrastructure and its integration with Fetch and HTML</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#definition"><span class="secno">2</span> <span class="content">Infrastructure definition</span></a>
    <li>
     <a href="#environment-settings-object-processing"><span class="secno">3</span> <span class="content">Environment settings object processing</span></a>
     <ol class="toc">
      <li><a href="#concept-client-hints-set"><span class="secno">3.1</span> <span class="content">Client hints set</span></a>
      <li><a href="#accept-ch-cache-definition"><span class="secno">3.2</span> <span class="content"><code>Accept-CH</code> cache</span></a>
      <li><a href="#critical-ch-algo"><span class="secno">3.3</span> <span class="content"><code>Critical-CH</code></span></a>
      <li><a href="#delegate-ch-algo"><span class="secno">3.4</span> <span class="content"><span><code>Delegate-CH</code></span></span></a>
      <li><a href="#interaction-with-accept-ch-frame"><span class="secno">3.5</span> <span class="content">Interaction with <code>ACCEPT_CH</code> frame</span></a>
     </ol>
    <li>
     <a href="#html"><span class="secno">4</span> <span class="content">Integration with HTML</span></a>
     <ol class="toc">
      <li><a href="#navigable"><span class="secno">4.1</span> <span class="content">Navigable</span></a>
      <li><a href="#navigation-response"><span class="secno">4.2</span> <span class="content">Navigation response</span></a>
      <li><a href="#service-worker-init"><span class="secno">4.3</span> <span class="content">Service Worker initialization</span></a>
      <li><a href="#standard-metadata-names"><span class="secno">4.4</span> <span class="content">Standard metadata names</span></a>
      <li><a href="#extending-environment-settings-object"><span class="secno">4.5</span> <span class="content">Extending environment settings object</span></a>
     </ol>
    <li><a href="#request-processing"><span class="secno">5</span> <span class="content">Request processing</span></a>
    <li><a href="#fetch"><span class="secno">6</span> <span class="content">Integration with Fetch</span></a>
    <li>
     <a href="#registry"><span class="secno">7</span> <span class="content">Feature Registry</span></a>
     <ol class="toc">
      <li><a href="#client-hints-token-definition"><span class="secno">7.1</span> <span class="content">Client hints token</span></a>
      <li><a href="#policy-controlled-features"><span class="secno">7.2</span> <span class="content">Policy-controlled features</span></a>
      <li><a href="#low-entropy-table"><span class="secno">7.3</span> <span class="content">Low-entropy hint table</span></a>
      <li><a href="#find-client-hint-value-section"><span class="secno">7.4</span> <span class="content">Find client hint value</span></a>
     </ol>
    <li><a href="#privacy"><span class="secno">8</span> <span class="content">Security and Privacy considerations</span></a>
    <li><a href="#terms"><span class="secno">9</span> <span class="content">Terms</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>Client Hints is collection of HTTP and user-agent features that enables
privacy-preserving, proactive content negotiation with an explicit third-party
delegation mechanism:</p>
   <ul>
    <li data-md>
     <p>Proactive content negotiation at the HTTP layer enables servers to request
delivery of specific hints, in order to enable optimized and automated
selection of resources based on a user’s device, conditions and preferences,
and lets clients decide which hint requests they want to grant, with
per-hint and per-origin granularity.</p>
    <li data-md>
     <p>Integration of said mechanism with web concepts, defined in this document,
enables browsers to benefit from content adaptation, and have it play nicely with
current web restrictions (e.g. same-origin policy).</p>
    <li data-md>
     <p>The opt-in nature of the mechanism enables browsers to advertise requested
hint data (e.g. user agent and device characteristics) selectively to
secure-transport origins, instead of appending such data on every outgoing
request.</p>
    <li data-md>
     <p>Origin opt-in applies to same-origin assets only and delivery to third-party
origins is subject to explicit first party delegation via Permissions Policy,
enabling tight control over which third party origins can access requested
hint data.</p>
   </ul>
   <p>The goal of Client Hints is to <strong>reduce passive fingerprinting</strong> on the web
while <strong>enabling scalable and privacy preserving content adaptation</strong> between
client and server, via a standardized set of content negotiation primitives at
the HTTP and user agent levels.</p>
   <h2 class="heading settled" data-level="2" id="definition"><span class="secno">2. </span><span class="content">Infrastructure definition</span><a class="self-link" href="#definition"></a></h2>
   <p>The specification of the Client Hints <strong>infrastructure</strong> is divided between the
following specifications and proposals:</p>
   <ul>
    <li data-md>
     <p>IETF <a data-link-type="biblio" href="#biblio-rfc8942" title="HTTP Client Hints">[RFC8942]</a></p>
     <ul>
      <li data-md>
       <p>Provides the motivation for Client Hints.</p>
      <li data-md>
       <p>Defines the <code>Accept-CH</code> response header, which servers may use to advertise
 support for certain Client Hints.</p>
      <li data-md>
       <p>Provides both general guidelines, and formal requirements, about Client
 Hints’ impact on caching, security, and privacy.</p>
      <li data-md>
       <p>Does <em>not</em> define any actual, particular hints – or say anything about how
 Client Hints works in web contexts.</p>
     </ul>
    <li data-md>
     <p>Client Hints infrastructure - this document</p>
     <ul>
      <li data-md>
       <p>Defines how web clients should process the <code>Accept-CH</code> headers sent by servers.</p>
      <li data-md>
       <p>Defines the environment settings object state related to <code>Accept-CH</code>,
 which stores information about which servers should get which hints.</p>
      <li data-md>
       <p>Defines how, and when, web clients should actually go about sending hints,
 based on the state of their environment settings object.</p>
       <ul>
        <li data-md>
         <p>More specifically, it integrates the HTML web concepts with Fetch’s
algorithms to make sure that opted-in hints are added to requests for
same-origin or delegated-to cross-origin requests. It also makes sure
hints are removed from not delegated-to cross-origin requests after
redirections.</p>
       </ul>
      <li data-md>
       <p>Defines the <code>Critical-CH</code> response header, which servers may use to request a reload
 to include critical Client Hints missing in the initial load.</p>
      <li data-md>
       <p>Integrates those concepts with the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> and <a data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[FETCH]</a> specifications,
 by patching various concepts there.</p>
     </ul>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-permissions-policy" title="Permissions Policy">W3C Permissions Policy specification</a></p>
     <ul>
      <li data-md>
       <p>In order to perform third party Client Hint delegation, Permissions Policy has
 been extended to control features within fetch requests (rather than just Documents). See <a href="https://w3c.github.io/webappsec-permissions-policy/#algo-should-request-be-allowed-to-use-feature"><cite>Permissions Policy</cite> § 9.10 Should request be allowed to use feature?</a></p>
     </ul>
    <li data-md>
     <p><a data-link-type="biblio" href="#biblio-client-hint-reliability" title="Client Hint Reliability">Client Hints Reliability</a></p>
     <ul>
      <li data-md>
       <p>See <a href="#interaction-with-accept-ch-frame">Interaction with <code>ACCEPT_CH</code> frame</a>.</p>
     </ul>
   </ul>
   <h2 class="heading settled" data-level="3" id="environment-settings-object-processing"><span class="secno">3. </span><span class="content">Environment settings object processing</span><a class="self-link" href="#environment-settings-object-processing"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="concept-client-hints-set"><span class="secno">3.1. </span><span class="content">Client hints set</span><a class="self-link" href="#concept-client-hints-set"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="client-hints-set">client hints set</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token">client hints token</a>s. </p>
   <h3 class="heading settled" data-level="3.2" id="accept-ch-cache-definition"><span class="secno">3.2. </span><span class="content"><code>Accept-CH</code> cache</span><a class="self-link" href="#accept-ch-cache-definition"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="accept-ch-cache">Accept-CH cache</dfn> is owned by the user agent and is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">ordered map</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">keyed</a> on <dfn class="dfn-paneled" data-dfn-for="accept-ch-cache" data-dfn-type="dfn" data-noexport id="accept-ch-cache-origin">origin</dfn> (an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>),
with a value of <dfn class="dfn-paneled" data-dfn-for="accept-ch-cache" data-dfn-type="dfn" data-noexport id="accept-ch-cache-client-hints-set">client hints set</dfn> (a <a data-link-type="dfn" href="#client-hints-set" id="ref-for-client-hints-set">client hints set</a>).</p>
   <p>The Accept-CH cache can effectively act as an alternative cookie store,
since sites can use each of the hints as a bit set on the client, and that information will be
communicated to them on every request. As such, a user agent MUST evict that
cache whenever the user clears their cookies or when session cookies expire.</p>
   <p>A site can clear the browser’s <code>Accept-CH</code> cache for its origin by sending an empty <code>Accept-CH</code> header in a response. This sets the origin’s <a data-link-type="dfn" href="#client-hints-set" id="ref-for-client-hints-set①">client hints set</a> to an empty set.</p>
   <p>There MAY be multiple <code>Accept-CH</code> headers per-response and <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc8941.html#name-lists" id="ref-for-name-lists">sf-lists</a> can be split across lines as long as each line contains at least one token.</p>
   <p class="note" role="note"><span class="marker">Note:</span> As the cache can only be modified by the top-level frame, it is considered to be partitioned.</p>
   <p>When asked to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="update-the-client-hints-set-from-cache">update the client hints set from cache</dfn> given a <var>settingsObject</var>:</p>
   <ol>
    <li>Let <var>hintSet</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">ordered set</a>. 
    <li>Let <var>originMatchingEntries</var> be the entries in the <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache">Accept-CH cache</a> whose <a data-link-type="dfn" href="#accept-ch-cache-origin" id="ref-for-accept-ch-cache-origin">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>. 
    <li>For each <var>entry</var> in <var>originMatchingEntries</var>, for each <var>token</var> in <var>entry</var>’s <a data-link-type="dfn" href="#accept-ch-cache-client-hints-set" id="ref-for-accept-ch-cache-client-hints-set">client hints set</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">append</a> the <var>token</var> to <var>hintSet</var>. 
    <li>Let <var>frameHintSet</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">ordered set</a> of hints requested by the <code>ACCEPT_CH</code> Frame (if any). 
    <li>For each <var>hint</var> in <var>frameHintSet</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">append</a> the <var>hint</var> to <var>hintSet</var>. 
    <li>For each <var>hint</var> in <var>hintSet</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append②">append</a> <var>hint</var> to <var>settingsObject</var>’s <a data-link-type="dfn" href="#environment-settings-object-client-hints-set" id="ref-for-environment-settings-object-client-hints-set">client hints set</a>. 
   </ol>
   <p>When asked to <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-create-or-override-the-cached-client-hints-set">create or override the cached client hints set</dfn> given a <var>settingsObject</var> and <var>response</var>:</p>
   <ol>
    <li>If <var>settingsObject</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context" id="ref-for-non-secure-context">non-secure context</a>, abort these steps. 
    <li>Let <var>browsingContext</var> be <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc">browsing context</a>. 
    <li>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a> does not equal <var>browsingContext</var>, abort these steps. 
    <li>If <var>response</var>’s <code>Accept-CH</code> header is not present, abort these steps. 
    <li>Let <var>hintSet</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set③">ordered set</a>. 
    <li>
     For each <var>hint</var> in the result of parsing <code>Accept-CH</code> according to the header parsing rules, as a <a data-link-type="dfn" href="#field-name" id="ref-for-field-name">field-name</a>: 
     <ol>
      <li>If <var>hint</var> is a <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token①">client hints token</a> add it to <var>hintSet</var>. 
     </ol>
    <li>Let <var>origin</var> be <var>response</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a>. 
    <li><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache①">Accept-CH cache</a>[<var>origin</var>] to <var>hintSet</var>. 
   </ol>
   <h3 class="heading settled" data-level="3.3" id="critical-ch-algo"><span class="secno">3.3. </span><span class="content"><code>Critical-CH</code></span><a class="self-link" href="#critical-ch-algo"></a></h3>
   <p>If an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin②">origin</a> is loaded and the server sets an <code>Accept-CH</code> header that
lists hints not already in the current <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache②">Accept-CH cache</a> that means only
subsiquent loads of that <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin③">origin</a> will include the hints. If it’s
critical that every load (including the first) has the requested Client Hints,
then the server can set a <code>Critical-CH</code> header to request a reload. The <code>Critical-CH</code> header itself does not modify the <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache③">Accept-CH cache</a>.</p>
   <p>A reload will only occur when a hint in the <code>Accept-CH</code> header is both <em>not in</em> the <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache④">Accept-CH cache</a> and <em>in</em> the <code>Critical-CH</code> header. If hints listed in
the <code>Critical-CH</code> header are already in the <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache⑤">Accept-CH cache</a> no reload is
needed as they were sent. If hints listed in the <code>Critical-CH</code> header are not
in the <code>Accept-CH</code> header a reload would not result in the hints being included
anyway.</p>
   <p>There MAY be multiple <code>Critical-CH</code> headers per-response and <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc8941.html#name-lists" id="ref-for-name-lists①">sf-lists</a> can be split across lines as long as each line contains at least one token.</p>
   <p>When asked if the user agent <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-should-reload-page-for-critical-client-hints">should reload page for critical client hints</dfn> given a <var>settingsObject</var> and <var>response</var>:</p>
   <ol>
    <li>If <var>settingsObject</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context" id="ref-for-non-secure-context①">non-secure context</a>, abort these steps. 
    <li>Let <var>browsingContext</var> be <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc①">browsing context</a>. 
    <li>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a> does not equal <var>browsingContext</var>, abort these steps. 
    <li>If <var>response</var>’s <code>Accept-CH</code> header is not present, abort these steps. 
    <li>If <var>response</var>’s <code>Critical-CH</code> header is not present, abort these steps. 
    <li>Let <var>missingHintSet</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set④">ordered set</a>. 
    <li>
     For each <var>hint</var> in the result of parsing <code>Accept-CH</code> according to the header parsing rules, as a <a data-link-type="dfn" href="#field-name" id="ref-for-field-name①">field-name</a>: 
     <ol>
      <li>If <var>hint</var> is a <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token②">client hints token</a> add it to <var>missingHintSet</var>. 
     </ol>
    <li>Let <var>origin</var> be <var>response</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin④">origin</a>. 
    <li>
     For each <var>hint</var> in <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache⑥">Accept-CH cache</a>[<var>origin</var>]: 
     <ol>
      <li>Remove <var>hint</var> from <var>missingHintSet</var> if present. 
     </ol>
    <li>
     For each <var>hint</var> in the result of parsing <code>Critical-CH</code> according to the header parsing rules, as a <a data-link-type="dfn" href="#field-name" id="ref-for-field-name②">field-name</a>: 
     <ol>
      <li>If <var>hint</var> is in <var>missingHintSet</var> return <code>true</code>. 
     </ol>
    <li>Return <code>false</code>. 
   </ol>
   <h3 class="heading settled" data-level="3.4" id="delegate-ch-algo"><span class="secno">3.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="delegate-ch"><code>Delegate-CH</code></dfn></span><a class="self-link" href="#delegate-ch-algo"></a></h3>
   <p>There MAY be multiple <code>Delegate-CH</code> tags per-document and this algorithm is run once for each in the order of the appearance of the tags.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This metadata <em>appends</em> <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token③">client hints token</a>s to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>'s <a data-link-type="dfn" href="#environment-settings-object-client-hints-set" id="ref-for-environment-settings-object-client-hints-set①">client hints set</a>. It <em>does not</em> add those hints to the <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache⑦">Accept-CH cache</a>.</p>
   <ol>
    <li>Let <var>metaElement</var> be the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#meta" id="ref-for-meta">meta</a></code> element. 
    <li>If any <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element">link</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-style-element" id="ref-for-the-style-element">style</a></code>, or <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script" id="ref-for-script">script</a></code> elements have begun to execute, then return. 
    <li>If <var>metaElement</var> has no <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-name" id="ref-for-attr-meta-name">name</a></code> attribute, or if that attribute’s value is not <code>delegate-ch</code>, then return. 
    <li>If <var>metaElement</var> has no <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-content" id="ref-for-attr-meta-content">content</a></code> attribute, or if that attribute’s value is the empty string, then return. 
    <li>Let <var>settingsObject</var> be <var>metaElement</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>. 
    <li>If <var>settingsObject</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context" id="ref-for-non-secure-context②">non-secure context</a>, abort these steps. 
    <li>Let <var>browsingContext</var> be <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global②">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc②">browsing context</a>. 
    <li>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a> does not equal <var>browsingContext</var>, abort these steps. 
    <li>Let <var>permissionsPolicy</var> be <var>metaElement</var>’s node document’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy" id="ref-for-concept-document-permissions-policy">permissions policy</a>. 
    <li>Let <var>delegateCHValue</var> be the value of <var>metaElement</var>’s <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-content" id="ref-for-attr-meta-content①">content</a></code> attribute. 
    <li>Let <var>policyDirective</var> be the result of running <a href="https://w3c.github.io/webappsec-permissions-policy/#algo-parse-policy-directive"><cite>Permissions Policy</cite> § 9.3 Parse policy directive</a> on <var>delegateCHValue</var> and the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑤">origin</a> of the <var>metaElement</var>’s node document. 
    <li>
     For each <var>feature</var>-><var>allowList</var> of <var>policyDirective</var>: 
     <ol>
      <li>If <var>feature</var> is not a <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token④">client hints token</a>, then continue. 
      <li>If <var>permissionsPolicy</var>[<var>feature</var>]'s <a data-link-type="biblio" href="#biblio-permissions-policy" title="Permissions Policy">permissions policy</a> is <code>*</code>, then continue. 
      <li>Let <var>filteredAllowList</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑤">ordered set</a>. 
      <li>
       For each <var>item</var> in <var>allowList</var>: 
       <ol>
        <li>If <var>item</var> is <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑥">origin</a> then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append③">Append</a> <var>item</var> to <var>filteredAllowList</var>. 
       </ol>
      <li><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append④">Append</a> <var>feature</var> to <var>settingsObject</var>’s <a data-link-type="dfn" href="#environment-settings-object-client-hints-set" id="ref-for-environment-settings-object-client-hints-set②">client hints set</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑤">Append</a> <var>filteredAllowList</var> to <var>permissionsPolicy</var>[<var>feature</var>]'s <a data-link-type="biblio" href="#biblio-permissions-policy" title="Permissions Policy">permissions policy</a>. 
     </ol>
   </ol>
   <p class="issue" id="issue-b9ef9066"><a class="self-link" href="#issue-b9ef9066"></a> Clarify detection of <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element①">link</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-style-element" id="ref-for-the-style-element①">style</a></code>, or <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script" id="ref-for-script①">script</a></code> element execution. <a href="https://github.com/WICG/client-hints-infrastructure/issues/110">[Issue #110]</a></p>
   <h3 class="heading settled" data-level="3.5" id="interaction-with-accept-ch-frame"><span class="secno">3.5. </span><span class="content">Interaction with <code>ACCEPT_CH</code> frame</span><a class="self-link" href="#interaction-with-accept-ch-frame"></a></h3>
   <p>The <code>ACCEPT_CH</code> frame is a way for Client Hints to be requested by a server
during the TLS handshake of HTTP/2 and HTTP/3. The requested hints are <em>not</em> persisted in the <a data-link-type="dfn" href="#accept-ch-cache" id="ref-for-accept-ch-cache⑧">Accept-CH cache</a>, but will be retrieved and merged when <a data-link-type="dfn" href="#update-the-client-hints-set-from-cache" id="ref-for-update-the-client-hints-set-from-cache">update the client hints set from cache</a> is run. The full processing model
is defined in <a data-link-type="biblio" href="#biblio-client-hint-reliability" title="Client Hint Reliability">Client Hints Reliability</a>.</p>
   <p>There MUST be only one <code>ACCEPT_CH</code> frames per-connection. Additional frames will be ignored.</p>
   <h2 class="heading settled" data-level="4" id="html"><span class="secno">4. </span><span class="content">Integration with HTML</span><a class="self-link" href="#html"></a></h2>
   <p>This specification integrates with the <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a> specification by patching the algorithms below:</p>
   <h3 class="heading settled" data-level="4.1" id="navigable"><span class="secno">4.1. </span><span class="content">Navigable</span><a class="self-link" href="#navigable"></a></h3>
   <p>Add a new field to <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#changing-nav-continuation-navigable" id="ref-for-changing-nav-continuation-navigable">navigable</a>:</p>
   <ul>
    <li>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="has-reloaded-for-critical-ch">has reloaded for <code>Critical-CH</code></dfn> boolean, initially <code>false</code>. 
   </ul>
   <h3 class="heading settled" data-level="4.2" id="navigation-response"><span class="secno">4.2. </span><span class="content">Navigation response</span><a class="self-link" href="#navigation-response"></a></h3>
   <p>At <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#populating-a-session-history-entry" id="ref-for-populating-a-session-history-entry">populating a session history entry</a>, in step 6 after substep 7 insert the following:</p>
   <ol>
    <li>Let <var>shouldReloadForCriticalClientHints</var> be <code>false</code>. 
    <li>
     If <var>navigable</var>’s <a data-link-type="dfn" href="#has-reloaded-for-critical-ch" id="ref-for-has-reloaded-for-critical-ch">has reloaded for Critical-CH</a> is <code>false</code>: 
     <ol>
      <li>Let <var>shouldReloadForCriticalClientHints</var> be the result of running <a data-link-type="abstract-op" href="#abstract-opdef-should-reload-page-for-critical-client-hints" id="ref-for-abstract-opdef-should-reload-page-for-critical-client-hints">should reload page for critical client hints</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a> and <var>response</var>. 
     </ol>
    <li>Run <a data-link-type="abstract-op" href="#abstract-opdef-create-or-override-the-cached-client-hints-set" id="ref-for-abstract-opdef-create-or-override-the-cached-client-hints-set">create or override the cached client hints set</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a> and <var>response</var> as inputs. 
    <li>
     If <var>shouldReloadForCriticalClientHints</var> then: 
     <ol>
      <li>Set <var>navigable</var>’s <a data-link-type="dfn" href="#has-reloaded-for-critical-ch" id="ref-for-has-reloaded-for-critical-ch①">has reloaded for Critical-CH</a> to <code>true</code>. 
      <li><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#reload" id="ref-for-reload">reload</a> <var>navigable</var>. 
     </ol>
   </ol>
   <h3 class="heading settled" data-level="4.3" id="service-worker-init"><span class="secno">4.3. </span><span class="content">Service Worker initialization</span><a class="self-link" href="#service-worker-init"></a></h3>
    At <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#set-up-a-worker-environment-settings-object" id="ref-for-set-up-a-worker-environment-settings-object">set up a worker environment settings object</a>,
after step 6, add the following step: 
   <ol>
    <li>If <var>worker global scope</var> implements <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope" id="ref-for-serviceworkerglobalscope">ServiceWorkerGlobalScope</a></code>, then set <var>settings object</var>’s <a data-link-type="dfn" href="#environment-settings-object-client-hints-set" id="ref-for-environment-settings-object-client-hints-set③">client hints set</a> to be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-clone" id="ref-for-list-clone">clone</a> of <var>outside settings</var>’ <a data-link-type="dfn" href="#environment-settings-object-client-hints-set" id="ref-for-environment-settings-object-client-hints-set④">client hints set</a>. 
   </ol>
   <h3 class="heading settled" data-level="4.4" id="standard-metadata-names"><span class="secno">4.4. </span><span class="content">Standard metadata names</span><a class="self-link" href="#standard-metadata-names"></a></h3>
    For the section <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#standard-metadata-names" id="ref-for-standard-metadata-names">standard metadata names</a>,
add a subsection named <code>delegate-ch</code> with the <a data-link-type="dfn" href="#delegate-ch" id="ref-for-delegate-ch">outlined explanation</a>. 
   <h3 class="heading settled" data-level="4.5" id="extending-environment-settings-object"><span class="secno">4.5. </span><span class="content">Extending environment settings object</span><a class="self-link" href="#extending-environment-settings-object"></a></h3>
   <p>An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> has a <dfn class="dfn-paneled" data-dfn-for="environment settings object" data-dfn-type="dfn" data-noexport id="environment-settings-object-client-hints-set">client hints set</dfn>: a <a data-link-type="dfn" href="#client-hints-set" id="ref-for-client-hints-set②">client hints set</a>, initially the empty set, used for <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetches</a> performed using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> as a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request">request</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>.</p>
   <h2 class="heading settled" data-level="5" id="request-processing"><span class="secno">5. </span><span class="content">Request processing</span><a class="self-link" href="#request-processing"></a></h2>
   <p>When asked to <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-append-client-hints-to-request">append client hints to request</dfn> with <var>settingsObject</var> and <var>request</var> as input, run the
following steps:</p>
   <ol>
    <li>If <var>request</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#non-subresource-request" id="ref-for-non-subresource-request">non-subresource request</a> for a "sharedworker" or "worker" <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination">destination</a>, exit without appending any hints to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>. 
    <li>Let <var>hintSet</var> be an empty <a data-link-type="dfn" href="#client-hints-set" id="ref-for-client-hints-set③">client hints set</a>. 
    <li>Run <a data-link-type="dfn" href="#update-the-client-hints-set-from-cache" id="ref-for-update-the-client-hints-set-from-cache①">update the client hints set from cache</a> with <var>settingsObject</var>. 
    <li>For each <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token⑤">client hints token</a> <var>lowEntropyHint</var> in the registry’s <a data-link-type="dfn" href="#low-entropy-hint-table" id="ref-for-low-entropy-hint-table">low entropy hint table</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑥">append</a> <var>lowEntropyHint</var> to <var>hintSet</var>. 
    <li>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a> is not null, then for each <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token⑥">client hints token</a> <var>requestHint</var> in <var>settingsObject</var>’s <a data-link-type="dfn" href="#environment-settings-object-client-hints-set" id="ref-for-environment-settings-object-client-hints-set⑤">client hints set</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append⑦">append</a> <var>requestHint</var> to <var>hintSet</var>. 
    <li>
     For each <var>hintName</var> in <var>hintSet</var>: 
     <ol>
      <li>
       If <var>request</var> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#navigation-request" id="ref-for-navigation-request">navigation request</a> for a "document" <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination" id="ref-for-concept-request-destination①">destination</a>: 
       <ol>
        <li>Let <var>requestPermitsHint</var> be the result of running <a href="https://w3c.github.io/webappsec-permissions-policy/#algo-should-request-be-allowed-to-use-feature"><cite>Permissions Policy</cite> § 9.10 Should request be allowed to use feature?</a> given <var>request</var> and <var>hintName</var>’s associated feature in <a href="#policy-controlled-features">§ 7.2 Policy-controlled features</a>. 
        <li>If <var>requestPermitsHint</var> is <code>false</code>, then continue to next <var>hintName</var>. 
       </ol>
      <li>If the user agent decides, in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> way (see <a href="#privacy">§ 8 Security and Privacy considerations</a>), to omit this hint then continue. 
      <li>Let <var>value</var> be the result of running <a data-link-type="dfn" href="#find-client-hint-value" id="ref-for-find-client-hint-value">find client hint value</a> with <var>hintName</var>. 
      <li>If the user agent decides, in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> way (see <a href="#privacy">§ 8 Security and Privacy considerations</a>), to modify <var>value</var> then do so. 
      <li><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append">append</a> <var>hintName</var>/<var>value</var> to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list①">header list</a>. 
     </ol>
   </ol>
   <p>When asked to <dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-remove-client-hints-from-redirect-if-needed">remove client hints from redirect if needed</dfn> with <var>request</var> as input, run the following steps:</p>
   <ol>
    <li>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>hintToken</var> in the list of <a data-link-type="dfn" href="#client-hints-token" id="ref-for-client-hints-token⑦">client hints token</a>s: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list②">header list</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-list-contains" id="ref-for-header-list-contains">contains</a> <var>hintToken</var>, then remove <var>hintToken</var> from <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list③">header list</a>. </p>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="6" id="fetch"><span class="secno">6. </span><span class="content">Integration with Fetch</span><a class="self-link" href="#fetch"></a></h2>
   <p>This specification integrates with the <a data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[FETCH]</a> specification by patching the algorithms below:</p>
   <p>In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a>, within step 8, after substep 23, run <a data-link-type="abstract-op" href="#abstract-opdef-append-client-hints-to-request" id="ref-for-abstract-opdef-append-client-hints-to-request">append client hints to request</a> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a> and <var>request</var> as input.</p>
   <p>In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-redirect-fetch" id="ref-for-concept-http-redirect-fetch">HTTP-redirect fetch</a>, after step 11, run <a data-link-type="abstract-op" href="#abstract-opdef-remove-client-hints-from-redirect-if-needed" id="ref-for-abstract-opdef-remove-client-hints-from-redirect-if-needed">remove client hints from redirect if needed</a> with <var>request</var> as input.</p>
   <p>In <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#forbidden-request-header" id="ref-for-forbidden-request-header">forbidden request-header</a>, to the list of headers within step 1, add <code>Save-Data</code>, <code>DPR</code>, <code>Device-Memory</code>, <code>Width</code>, and <code>Viewport-Width</code>.</p>
   <h2 class="heading settled" data-level="7" id="registry"><span class="secno">7. </span><span class="content">Feature Registry</span><a class="self-link" href="#registry"></a></h2>
   <p class="note" role="note"><span class="marker">Note:</span> This section contains feature-specific definitions.
New features that rely on the Client Hints infrastructure need to add their respective definitions to this registry.
User Agents can implement some of those features without implementing others.</p>
   <h3 class="heading settled" data-level="7.1" id="client-hints-token-definition"><span class="secno">7.1. </span><span class="content">Client hints token</span><a class="self-link" href="#client-hints-token-definition"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="client-hints-token">client hints token</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-lowercase" id="ref-for-byte-lowercase">byte-lowercase</a> representation of one of <code>Save-Data</code>, <code>Sec-CH-DPR</code>, <code>Sec-CH-Width</code>, <code>Sec-CH-Viewport-Width</code>, <code>Sec-CH-Viewport-Height</code>, <code>Sec-CH-Device-Memory</code>, <code>Sec-CH-RTT</code>, <code>Sec-CH-Downlink</code>, <code>Sec-CH-ECT</code>, <code>Sec-CH-Prefers-Color-Scheme</code>, <code>Sec-CH-Prefers-Reduced-Motion</code>, <code>Sec-CH-UA</code>, <code>Sec-CH-UA-Arch</code>, <code>Sec-CH-UA-Bitness</code>, <code>Sec-CH-UA-Full-Version</code>, <code>Sec-CH-UA-Full-Version-List</code>, <code>Sec-CH-UA-Mobile</code>, <code>Sec-CH-UA-Model</code>, <code>Sec-CH-UA-Platform</code>, <code>Sec-CH-UA-Platform-Version</code>, or <code>Sec-CH-UA-WoW64</code>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> A client hints token will also match the request header sent by the user agent when
appropriate (as determined by the <a href="#request-processing">request processing algorithm</a>).</p>
   <h3 class="heading settled" data-level="7.2" id="policy-controlled-features"><span class="secno">7.2. </span><span class="content">Policy-controlled features</span><a class="self-link" href="#policy-controlled-features"></a></h3>
   <p>This document defines <dfn data-dfn-type="dfn" data-export id="policy-controlled-client-hints-features">policy-controlled client hints features<a class="self-link" href="#policy-controlled-client-hints-features"></a></dfn>,
the following <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">policy-controlled features</a>:</p>
   <ul>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-save-data">ch-save-data<a class="self-link" href="#ch-save-data"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist">default allowlist</a> of <code>'*'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-dpr">ch-dpr<a class="self-link" href="#ch-dpr"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-width">ch-width<a class="self-link" href="#ch-width"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist②">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-viewport-width">ch-viewport-width<a class="self-link" href="#ch-viewport-width"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist③">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-viewport-height">ch-viewport-height<a class="self-link" href="#ch-viewport-height"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist④">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-device-memory">ch-device-memory<a class="self-link" href="#ch-device-memory"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist⑤">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-rtt">ch-rtt<a class="self-link" href="#ch-rtt"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist⑥">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-downlink">ch-downlink<a class="self-link" href="#ch-downlink"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist⑦">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ect">ch-ect<a class="self-link" href="#ch-ect"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist⑧">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-prefers-color-scheme">ch-prefers-color-scheme<a class="self-link" href="#ch-prefers-color-scheme"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist⑨">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-prefers-reduced-motion">ch-prefers-reduced-motion<a class="self-link" href="#ch-prefers-reduced-motion"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①⓪">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua">ch-ua<a class="self-link" href="#ch-ua"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①①">default allowlist</a> of <code>'*'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-arch">ch-ua-arch<a class="self-link" href="#ch-ua-arch"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①②">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-bitness">ch-ua-bitness<a class="self-link" href="#ch-ua-bitness"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①③">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-full-version">ch-ua-full-version<a class="self-link" href="#ch-ua-full-version"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①④">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-full-version-list">ch-ua-full-version-list<a class="self-link" href="#ch-ua-full-version-list"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①⑤">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-mobile">ch-ua-mobile<a class="self-link" href="#ch-ua-mobile"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①⑥">default allowlist</a> of <code>'*'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-model">ch-ua-model<a class="self-link" href="#ch-ua-model"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①⑦">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-platform">ch-ua-platform<a class="self-link" href="#ch-ua-platform"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①⑧">default allowlist</a> of <code>'*'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-platform-version">ch-ua-platform-version<a class="self-link" href="#ch-ua-platform-version"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①⑨">default allowlist</a> of <code>'self'</code></p>
    <li data-md>
     <p><code><dfn data-dfn-type="dfn" data-export id="ch-ua-wow64">ch-ua-wow64<a class="self-link" href="#ch-ua-wow64"></a></dfn></code> which has a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist②⓪">default allowlist</a> of <code>'self'</code></p>
   </ul>
   <p class="issue" id="issue-0277eb34"><a class="self-link" href="#issue-0277eb34"></a> Should we tie low-entropy-ness to allowlists, generally?</p>
   <h3 class="heading settled" data-level="7.3" id="low-entropy-table"><span class="secno">7.3. </span><span class="content">Low-entropy hint table</span><a class="self-link" href="#low-entropy-table"></a></h3>
    The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="low-entropy hint table|low entropy hint table" id="low-entropy-hint-table">low-entropy hint table</dfn> below defines hints that are safe to send by default due to their low amounts of entropy. 
   <p>A <dfn data-dfn-type="dfn" data-export id="high-entropy-client-hint">high-entropy client hint<a class="self-link" href="#high-entropy-client-hint"></a></dfn> is a client hint that is not in the <a data-link-type="dfn" href="#low-entropy-hint-table" id="ref-for-low-entropy-hint-table①">low-entropy hint table</a>.</p>
   <table>
    <thead>
     <tr>
      <th><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-name" id="ref-for-concept-header-name">Name</a> 
      <th><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-value" id="ref-for-concept-header-value">Value</a> 
    <tbody>
     <tr>
      <td><code>Save-Data</code> 
      <td>a suitable <a href="https://wicg.github.io/savedata/#save-data-request-header-field">Save-Data value</a> 
     <tr>
      <td><code>Sec-CH-UA</code> 
      <td>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua">UA value</a> 
     <tr>
      <td><code>Sec-CH-UA-Mobile</code> 
      <td>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-mobile">Mobile value</a> 
     <tr>
      <td><code>Sec-CH-UA-Platform</code> 
      <td>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-platform">Platform value</a> 
   </table>
   <p class="note" role="note"><span class="marker">Note:</span> If the value transmitted by <code>Save-Data</code> is the empty string, the header will be omitted entirely.
This is done to reduce redundant header information sent by default.</p>
   <h3 class="heading settled" data-level="7.4" id="find-client-hint-value-section"><span class="secno">7.4. </span><span class="content">Find client hint value</span><a class="self-link" href="#find-client-hint-value-section"></a></h3>
   <p>When asked to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="find-client-hint-value">find client hint value</dfn>, given <var>hint</var> as input, switch on <var>hint</var> and return the result:</p>
   <dl class="switch">
    <dt><code>Save-Data</code> 
    <dd>a suitable <a href="https://wicg.github.io/savedata/#save-data-request-header-field">Save-Data value</a> 
    <dt><code>DPR</code> 
    <dd>a suitable <a href>DPR value</a> 
    <dt><code>Viewport-Width</code> 
    <dd>a suitable <a href>Viewport-Width value</a> 
    <dt><code>Viewport-Height</code> 
    <dd>a suitable <a href>Viewport-Height value</a> 
    <dt><code>Width</code> 
    <dd>a suitable <a href>Width value</a> 
    <dt><code>Device-Memory</code> 
    <dd>a suitable <a href="https://w3c.github.io/device-memory/#sec-device-memory-client-hint-header">Device-Memory value</a> 
    <dt><code>RTT</code> 
    <dd>a suitable <a href="https://wicg.github.io/netinfo/#rtt-request-header-field">RTT value</a> 
    <dt><code>Downlink</code> 
    <dd>a suitable <a href="https://wicg.github.io/netinfo/#downlink-request-header-field">Downlink value</a> 
    <dt><code>ECT</code> 
    <dd>a suitable <a href="https://wicg.github.io/netinfo/#ect-request-header-field">ECT value</a> 
    <dt><code>Prefers-Color-Scheme</code> 
    <dd>a suitable <a href="https://wicg.github.io/user-preference-media-features-headers/#sec-ch-prefers-color-scheme">color theme value</a> 
    <dt><code>Prefers-Reduced-Motion</code> 
    <dd>a suitable <a href="https://wicg.github.io/user-preference-media-features-headers/#sec-ch-prefers-reduced-motion">Reduced-Motion value</a> 
    <dt><code>UA</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua">UA value</a> 
    <dt><code>UA-Arch</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-arch">Arch value</a> 
    <dt><code>UA-Bitness</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-bitness">Bitness value</a> 
    <dt><code>UA-Full-Version</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-full-version">Full-Version value</a> 
    <dt><code>UA-Full-Version-List</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-full-version-list">Full-Version-List value</a> 
    <dt><code>UA-Mobile</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-mobile">Mobile value</a> 
    <dt><code>UA-Model</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-model">Model value</a> 
    <dt><code>UA-Platform</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-platform">Platform value</a> 
    <dt><code>UA-Platform-Version</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-platform-version">Platform-Version value</a> 
    <dt><code>UA-WoW64</code> 
    <dd>a suitable <a href="https://wicg.github.io/ua-client-hints/#sec-ch-ua-wow64">WoW64 value</a> 
   </dl>
   <p class="issue" id="issue-707decdc"><a class="self-link" href="#issue-707decdc"></a> Links for image features are broken, need to actually define that and link to them.</p>
   <h2 class="heading settled" data-level="8" id="privacy"><span class="secno">8. </span><span class="content">Security and Privacy considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>This specification exposes information regarding the user’s preferences and agent, which can be used as an active fingerprinting vector. <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">User agents</a> implementing this specification need to be aware of that, and take that into consideration when deciding whether to implement specific hints,
modify their returned values for a given hint, or omit the hint entirely.</p>
   <p>For example, the user might have a site specific setting to override or disable specific client hints to reduce the potential for fingerprinting.</p>
   <h2 class="heading settled" data-level="9" id="terms"><span class="secno">9. </span><span class="content">Terms</span><a class="self-link" href="#terms"></a></h2>
   <p>The following terms are defined in the HTTP specifications: <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport href="https://tools.ietf.org/html/rfc7230#section-3.2" id="field-name">field-name</dfn></p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#accept-ch-cache">Accept-CH cache</a><span>, in § 3.2</span>
   <li><a href="#abstract-opdef-append-client-hints-to-request">append client hints to request</a><span>, in § 5</span>
   <li><a href="#ch-device-memory">ch-device-memory</a><span>, in § 7.2</span>
   <li><a href="#ch-downlink">ch-downlink</a><span>, in § 7.2</span>
   <li><a href="#ch-dpr">ch-dpr</a><span>, in § 7.2</span>
   <li><a href="#ch-ect">ch-ect</a><span>, in § 7.2</span>
   <li><a href="#ch-prefers-color-scheme">ch-prefers-color-scheme</a><span>, in § 7.2</span>
   <li><a href="#ch-prefers-reduced-motion">ch-prefers-reduced-motion</a><span>, in § 7.2</span>
   <li><a href="#ch-rtt">ch-rtt</a><span>, in § 7.2</span>
   <li><a href="#ch-save-data">ch-save-data</a><span>, in § 7.2</span>
   <li><a href="#ch-ua">ch-ua</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-arch">ch-ua-arch</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-bitness">ch-ua-bitness</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-full-version">ch-ua-full-version</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-full-version-list">ch-ua-full-version-list</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-mobile">ch-ua-mobile</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-model">ch-ua-model</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-platform">ch-ua-platform</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-platform-version">ch-ua-platform-version</a><span>, in § 7.2</span>
   <li><a href="#ch-ua-wow64">ch-ua-wow64</a><span>, in § 7.2</span>
   <li><a href="#ch-viewport-height">ch-viewport-height</a><span>, in § 7.2</span>
   <li><a href="#ch-viewport-width">ch-viewport-width</a><span>, in § 7.2</span>
   <li><a href="#ch-width">ch-width</a><span>, in § 7.2</span>
   <li>
    client hints set
    <ul>
     <li><a href="#client-hints-set">definition of</a><span>, in § 3.1</span>
     <li><a href="#accept-ch-cache-client-hints-set">dfn for accept-ch-cache</a><span>, in § 3.2</span>
     <li><a href="#environment-settings-object-client-hints-set">dfn for environment settings object</a><span>, in § 4.5</span>
    </ul>
   <li><a href="#client-hints-token">client hints token</a><span>, in § 7.1</span>
   <li><a href="#abstract-opdef-create-or-override-the-cached-client-hints-set">create or override the cached client hints set</a><span>, in § 3.2</span>
   <li><a href="#delegate-ch">Delegate-CH</a><span>, in § 3.4</span>
   <li><a href="#field-name">field-name</a><span>, in § 9</span>
   <li><a href="#find-client-hint-value">find client hint value</a><span>, in § 7.4</span>
   <li><a href="#has-reloaded-for-critical-ch">has reloaded for Critical-CH</a><span>, in § 4.1</span>
   <li><a href="#high-entropy-client-hint">high-entropy client hint</a><span>, in § 7.3</span>
   <li><a href="#low-entropy-hint-table">low entropy hint table</a><span>, in § 7.3</span>
   <li><a href="#low-entropy-hint-table">low-entropy hint table</a><span>, in § 7.3</span>
   <li><a href="#accept-ch-cache-origin">origin</a><span>, in § 3.2</span>
   <li><a href="#policy-controlled-client-hints-features">policy-controlled client hints features</a><span>, in § 7.2</span>
   <li><a href="#abstract-opdef-remove-client-hints-from-redirect-if-needed">remove client hints from redirect if needed</a><span>, in § 5</span>
   <li><a href="#abstract-opdef-should-reload-page-for-critical-client-hints">should reload page for critical client hints</a><span>, in § 3.3</span>
   <li><a href="#update-the-client-hints-set-from-cache">update the client hints set from cache</a><span>, in § 3.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a6a8ec88">append</span>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="d5434eef">contains</span>
     <li><span class="dfn-paneled" id="3ae34c95">destination</span>
     <li><span class="dfn-paneled" id="a33db89a">fetch</span>
     <li><span class="dfn-paneled" id="ad6ec3ab">forbidden request-header</span>
     <li><span class="dfn-paneled" id="6ee0eab1">header list</span>
     <li><span class="dfn-paneled" id="980528b0">http-network-or-cache fetch</span>
     <li><span class="dfn-paneled" id="8acee9c8">http-redirect fetch</span>
     <li><span class="dfn-paneled" id="4b84a0bc">name</span>
     <li><span class="dfn-paneled" id="2889d1ec">navigation request</span>
     <li><span class="dfn-paneled" id="5a391458">non-subresource request</span>
     <li><span class="dfn-paneled" id="162d2b51">request</span>
     <li><span class="dfn-paneled" id="8a608b90">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6d88ab2e">browsing context</span>
     <li><span class="dfn-paneled" id="5a88c1c3">content</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="8a30477b">global object</span>
     <li><span class="dfn-paneled" id="6cfa013d">link</span>
     <li><span class="dfn-paneled" id="64b89595">meta</span>
     <li><span class="dfn-paneled" id="a23d5e9f">name</span>
     <li><span class="dfn-paneled" id="791b51ec">navigable</span>
     <li><span class="dfn-paneled" id="5155c2d3">non-secure context</span>
     <li><span class="dfn-paneled" id="43ac8374">origin</span>
     <li><span class="dfn-paneled" id="a41102eb">permissions policy</span>
     <li><span class="dfn-paneled" id="4405ae42">populating a session history entry</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="06b3efd0">reload</span>
     <li><span class="dfn-paneled" id="7393da89">same origin</span>
     <li><span class="dfn-paneled" id="0cf3964f">script</span>
     <li><span class="dfn-paneled" id="bbb5f6df">set up a worker environment settings object</span>
     <li><span class="dfn-paneled" id="5e137c60">standard metadata names</span>
     <li><span class="dfn-paneled" id="ba920583">style</span>
     <li><span class="dfn-paneled" id="ae2a6342">top-level browsing context</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a3b18719">append</span>
     <li><span class="dfn-paneled" id="7838e1c1">byte-lowercase</span>
     <li><span class="dfn-paneled" id="027e3e49">clone</span>
     <li><span class="dfn-paneled" id="16d07e10">for each</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="d14a6f26">key</span>
     <li><span class="dfn-paneled" id="84b454ff">ordered map</span>
     <li><span class="dfn-paneled" id="692595fe">ordered set</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="0e6b2056">set <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS-POLICY-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1570624a">default allowlist</span>
     <li><span class="dfn-paneled" id="cc890cc1">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SERVICE-WORKERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="86d2a717">ServiceWorkerGlobalScope</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STRUCTURED-FIELDS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="36e6e52c">sf-lists</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="959ad97b">origin</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
   <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc8942">[RFC8942]
   <dd>I. Grigorik; Y. Weiss. <a href="https://www.rfc-editor.org/rfc/rfc8942"><cite>HTTP Client Hints</cite></a>. February 2021. Experimental. URL: <a href="https://www.rfc-editor.org/rfc/rfc8942">https://www.rfc-editor.org/rfc/rfc8942</a>
   <dt id="biblio-service-workers">[SERVICE-WORKERS]
   <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://w3c.github.io/ServiceWorker/"><cite>Service Workers</cite></a>. URL: <a href="https://w3c.github.io/ServiceWorker/">https://w3c.github.io/ServiceWorker/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-client-hint-reliability">[CLIENT-HINT-RELIABILITY]
   <dd>David Benjamin. <a href="https://datatracker.ietf.org/doc/html/draft-davidben-http-client-hint-reliability"><cite>Client Hint Reliability</cite></a>. URL: <a href="https://datatracker.ietf.org/doc/html/draft-davidben-http-client-hint-reliability">https://datatracker.ietf.org/doc/html/draft-davidben-http-client-hint-reliability</a>
   <dt id="biblio-permissions-policy">[PERMISSIONS-POLICY]
   <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Clarify detection of <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element">link</a></code>, <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-style-element">style</a></code>, or <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script">script</a></code> element execution. <a href="https://github.com/WICG/client-hints-infrastructure/issues/110">[Issue #110]</a> <a class="issue-return" href="#issue-b9ef9066" title="Jump to section">↵</a></div>
   <div class="issue"> Should we tie low-entropy-ness to allowlists, generally? <a class="issue-return" href="#issue-0277eb34" title="Jump to section">↵</a></div>
   <div class="issue"> Links for image features are broken, need to actually define that and link to them. <a class="issue-return" href="#issue-707decdc" title="Jump to section">↵</a></div>
  </div>
<script>/* script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['a6a8ec88'] = {"dfnID": "a6a8ec88", "url": "https://fetch.spec.whatwg.org/#concept-header-list-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-concept-header-list-append"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['857d5516'] = {"dfnID": "857d5516", "url": "https://fetch.spec.whatwg.org/#concept-request-client", "dfnText": "client", "refSections": [{"refs": [{"id": "ref-for-concept-request-client"}], "title": "4.5. Extending environment settings object"}, {"refs": [{"id": "ref-for-concept-request-client\u2460"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['d5434eef'] = {"dfnID": "d5434eef", "url": "https://fetch.spec.whatwg.org/#header-list-contains", "dfnText": "contains", "refSections": [{"refs": [{"id": "ref-for-header-list-contains"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['3ae34c95'] = {"dfnID": "3ae34c95", "url": "https://fetch.spec.whatwg.org/#concept-request-destination", "dfnText": "destination", "refSections": [{"refs": [{"id": "ref-for-concept-request-destination"}, {"id": "ref-for-concept-request-destination\u2460"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['a33db89a'] = {"dfnID": "a33db89a", "url": "https://fetch.spec.whatwg.org/#concept-fetch", "dfnText": "fetch", "refSections": [{"refs": [{"id": "ref-for-concept-fetch"}], "title": "4.5. Extending environment settings object"}], "external": true};
window.dfnpanelData['ad6ec3ab'] = {"dfnID": "ad6ec3ab", "url": "https://fetch.spec.whatwg.org/#forbidden-request-header", "dfnText": "forbidden request-header", "refSections": [{"refs": [{"id": "ref-for-forbidden-request-header"}], "title": "6. Integration with Fetch"}], "external": true};
window.dfnpanelData['6ee0eab1'] = {"dfnID": "6ee0eab1", "url": "https://fetch.spec.whatwg.org/#concept-request-header-list", "dfnText": "header list", "refSections": [{"refs": [{"id": "ref-for-concept-request-header-list"}, {"id": "ref-for-concept-request-header-list\u2460"}, {"id": "ref-for-concept-request-header-list\u2461"}, {"id": "ref-for-concept-request-header-list\u2462"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['980528b0'] = {"dfnID": "980528b0", "url": "https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch", "dfnText": "http-network-or-cache fetch", "refSections": [{"refs": [{"id": "ref-for-concept-http-network-or-cache-fetch"}], "title": "6. Integration with Fetch"}], "external": true};
window.dfnpanelData['8acee9c8'] = {"dfnID": "8acee9c8", "url": "https://fetch.spec.whatwg.org/#concept-http-redirect-fetch", "dfnText": "http-redirect fetch", "refSections": [{"refs": [{"id": "ref-for-concept-http-redirect-fetch"}], "title": "6. Integration with Fetch"}], "external": true};
window.dfnpanelData['4b84a0bc'] = {"dfnID": "4b84a0bc", "url": "https://fetch.spec.whatwg.org/#concept-header-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-concept-header-name"}], "title": "7.3. Low-entropy hint table"}], "external": true};
window.dfnpanelData['2889d1ec'] = {"dfnID": "2889d1ec", "url": "https://fetch.spec.whatwg.org/#navigation-request", "dfnText": "navigation request", "refSections": [{"refs": [{"id": "ref-for-navigation-request"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['5a391458'] = {"dfnID": "5a391458", "url": "https://fetch.spec.whatwg.org/#non-subresource-request", "dfnText": "non-subresource request", "refSections": [{"refs": [{"id": "ref-for-non-subresource-request"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['162d2b51'] = {"dfnID": "162d2b51", "url": "https://fetch.spec.whatwg.org/#concept-request-request", "dfnText": "request", "refSections": [{"refs": [{"id": "ref-for-concept-request-request"}], "title": "4.5. Extending environment settings object"}], "external": true};
window.dfnpanelData['8a608b90'] = {"dfnID": "8a608b90", "url": "https://fetch.spec.whatwg.org/#concept-header-value", "dfnText": "value", "refSections": [{"refs": [{"id": "ref-for-concept-header-value"}], "title": "7.3. Low-entropy hint table"}], "external": true};
window.dfnpanelData['6d88ab2e'] = {"dfnID": "6d88ab2e", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc", "dfnText": "browsing context", "refSections": [{"refs": [{"id": "ref-for-window-bc"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-window-bc\u2460"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-window-bc\u2461"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['5a88c1c3'] = {"dfnID": "5a88c1c3", "url": "https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-content", "dfnText": "content", "refSections": [{"refs": [{"id": "ref-for-attr-meta-content"}, {"id": "ref-for-attr-meta-content\u2460"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['3e12e042'] = {"dfnID": "3e12e042", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "dfnText": "environment settings object", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object"}], "title": "3.4. Delegate-CH"}, {"refs": [{"id": "ref-for-environment-settings-object\u2460"}, {"id": "ref-for-environment-settings-object\u2461"}], "title": "4.5. Extending environment settings object"}], "external": true};
window.dfnpanelData['8a30477b'] = {"dfnID": "8a30477b", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global", "dfnText": "global object", "refSections": [{"refs": [{"id": "ref-for-concept-settings-object-global"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-concept-settings-object-global\u2460"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-concept-settings-object-global\u2461"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['6cfa013d'] = {"dfnID": "6cfa013d", "url": "https://html.spec.whatwg.org/multipage/semantics.html#the-link-element", "dfnText": "link", "refSections": [{"refs": [{"id": "ref-for-the-link-element"}, {"id": "ref-for-the-link-element\u2460"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['64b89595'] = {"dfnID": "64b89595", "url": "https://html.spec.whatwg.org/multipage/semantics.html#meta", "dfnText": "meta", "refSections": [{"refs": [{"id": "ref-for-meta"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['a23d5e9f'] = {"dfnID": "a23d5e9f", "url": "https://html.spec.whatwg.org/multipage/semantics.html#attr-meta-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-attr-meta-name"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['791b51ec'] = {"dfnID": "791b51ec", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#changing-nav-continuation-navigable", "dfnText": "navigable", "refSections": [{"refs": [{"id": "ref-for-changing-nav-continuation-navigable"}], "title": "4.1. Navigable"}], "external": true};
window.dfnpanelData['5155c2d3'] = {"dfnID": "5155c2d3", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context", "dfnText": "non-secure context", "refSections": [{"refs": [{"id": "ref-for-non-secure-context"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-non-secure-context\u2460"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-non-secure-context\u2461"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['43ac8374'] = {"dfnID": "43ac8374", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-settings-object-origin"}], "title": "3.2. Accept-CH cache"}], "external": true};
window.dfnpanelData['a41102eb'] = {"dfnID": "a41102eb", "url": "https://html.spec.whatwg.org/multipage/dom.html#concept-document-permissions-policy", "dfnText": "permissions policy", "refSections": [{"refs": [{"id": "ref-for-concept-document-permissions-policy"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['4405ae42'] = {"dfnID": "4405ae42", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#populating-a-session-history-entry", "dfnText": "populating a session history entry", "refSections": [{"refs": [{"id": "ref-for-populating-a-session-history-entry"}], "title": "4.2. Navigation response"}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}], "title": "3.4. Delegate-CH"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2460"}, {"id": "ref-for-relevant-settings-object\u2461"}], "title": "4.2. Navigation response"}, {"refs": [{"id": "ref-for-relevant-settings-object\u2462"}], "title": "6. Integration with Fetch"}], "external": true};
window.dfnpanelData['06b3efd0'] = {"dfnID": "06b3efd0", "url": "https://html.spec.whatwg.org/multipage/browsing-the-web.html#reload", "dfnText": "reload", "refSections": [{"refs": [{"id": "ref-for-reload"}], "title": "4.2. Navigation response"}], "external": true};
window.dfnpanelData['7393da89'] = {"dfnID": "7393da89", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin", "dfnText": "same origin", "refSections": [{"refs": [{"id": "ref-for-same-origin"}], "title": "3.2. Accept-CH cache"}], "external": true};
window.dfnpanelData['0cf3964f'] = {"dfnID": "0cf3964f", "url": "https://html.spec.whatwg.org/multipage/scripting.html#script", "dfnText": "script", "refSections": [{"refs": [{"id": "ref-for-script"}, {"id": "ref-for-script\u2460"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['bbb5f6df'] = {"dfnID": "bbb5f6df", "url": "https://html.spec.whatwg.org/multipage/workers.html#set-up-a-worker-environment-settings-object", "dfnText": "set up a worker environment settings object", "refSections": [{"refs": [{"id": "ref-for-set-up-a-worker-environment-settings-object"}], "title": "4.3. Service Worker initialization"}], "external": true};
window.dfnpanelData['5e137c60'] = {"dfnID": "5e137c60", "url": "https://html.spec.whatwg.org/multipage/semantics.html#standard-metadata-names", "dfnText": "standard metadata names", "refSections": [{"refs": [{"id": "ref-for-standard-metadata-names"}], "title": "4.4. Standard metadata names"}], "external": true};
window.dfnpanelData['ba920583'] = {"dfnID": "ba920583", "url": "https://html.spec.whatwg.org/multipage/semantics.html#the-style-element", "dfnText": "style", "refSections": [{"refs": [{"id": "ref-for-the-style-element"}, {"id": "ref-for-the-style-element\u2460"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['ae2a6342'] = {"dfnID": "ae2a6342", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context", "dfnText": "top-level browsing context", "refSections": [{"refs": [{"id": "ref-for-top-level-browsing-context"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-top-level-browsing-context\u2460"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-top-level-browsing-context\u2461"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['a3b18719'] = {"dfnID": "a3b18719", "url": "https://infra.spec.whatwg.org/#set-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-set-append"}, {"id": "ref-for-set-append\u2460"}, {"id": "ref-for-set-append\u2461"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-set-append\u2462"}, {"id": "ref-for-set-append\u2463"}, {"id": "ref-for-set-append\u2464"}], "title": "3.4. Delegate-CH"}, {"refs": [{"id": "ref-for-set-append\u2465"}, {"id": "ref-for-set-append\u2466"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['7838e1c1'] = {"dfnID": "7838e1c1", "url": "https://infra.spec.whatwg.org/#byte-lowercase", "dfnText": "byte-lowercase", "refSections": [{"refs": [{"id": "ref-for-byte-lowercase"}], "title": "7.1. Client hints token"}], "external": true};
window.dfnpanelData['027e3e49'] = {"dfnID": "027e3e49", "url": "https://infra.spec.whatwg.org/#list-clone", "dfnText": "clone", "refSections": [{"refs": [{"id": "ref-for-list-clone"}], "title": "4.3. Service Worker initialization"}], "external": true};
window.dfnpanelData['16d07e10'] = {"dfnID": "16d07e10", "url": "https://infra.spec.whatwg.org/#list-iterate", "dfnText": "for each", "refSections": [{"refs": [{"id": "ref-for-list-iterate"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['860300d4'] = {"dfnID": "860300d4", "url": "https://infra.spec.whatwg.org/#implementation-defined", "dfnText": "implementation-defined", "refSections": [{"refs": [{"id": "ref-for-implementation-defined"}, {"id": "ref-for-implementation-defined\u2460"}], "title": "5. Request processing"}], "external": true};
window.dfnpanelData['d14a6f26'] = {"dfnID": "d14a6f26", "url": "https://infra.spec.whatwg.org/#map-key", "dfnText": "key", "refSections": [{"refs": [{"id": "ref-for-map-key"}], "title": "3.2. Accept-CH cache"}], "external": true};
window.dfnpanelData['84b454ff'] = {"dfnID": "84b454ff", "url": "https://infra.spec.whatwg.org/#ordered-map", "dfnText": "ordered map", "refSections": [{"refs": [{"id": "ref-for-ordered-map"}], "title": "3.2. Accept-CH cache"}], "external": true};
window.dfnpanelData['692595fe'] = {"dfnID": "692595fe", "url": "https://infra.spec.whatwg.org/#ordered-set", "dfnText": "ordered set", "refSections": [{"refs": [{"id": "ref-for-ordered-set"}], "title": "3.1. Client hints set"}, {"refs": [{"id": "ref-for-ordered-set\u2460"}, {"id": "ref-for-ordered-set\u2461"}, {"id": "ref-for-ordered-set\u2462"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-ordered-set\u2463"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-ordered-set\u2464"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['15e48c39'] = {"dfnID": "15e48c39", "url": "https://infra.spec.whatwg.org/#ordered-set", "dfnText": "set", "refSections": [{"refs": [{"id": "ref-for-ordered-set"}], "title": "3.1. Client hints set"}, {"refs": [{"id": "ref-for-ordered-set\u2460"}, {"id": "ref-for-ordered-set\u2461"}, {"id": "ref-for-ordered-set\u2462"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-ordered-set\u2463"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-ordered-set\u2464"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['0e6b2056'] = {"dfnID": "0e6b2056", "url": "https://infra.spec.whatwg.org/#map-set", "dfnText": "set (for map)", "refSections": [{"refs": [{"id": "ref-for-map-set"}], "title": "3.2. Accept-CH cache"}], "external": true};
window.dfnpanelData['6d19ac93'] = {"dfnID": "6d19ac93", "url": "https://infra.spec.whatwg.org/#user-agent", "dfnText": "user agent", "refSections": [{"refs": [{"id": "ref-for-user-agent"}], "title": "8. Security and Privacy considerations"}], "external": true};
window.dfnpanelData['1570624a'] = {"dfnID": "1570624a", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist", "dfnText": "default allowlist", "refSections": [{"refs": [{"id": "ref-for-policy-controlled-feature-default-allowlist"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2461"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2462"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2463"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2464"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2465"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2466"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2467"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2468"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u24ea"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2460"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2461"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2462"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2463"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2464"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2465"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2466"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2467"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460\u2468"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2461\u24ea"}], "title": "7.2. Policy-controlled features"}], "external": true};
window.dfnpanelData['cc890cc1'] = {"dfnID": "cc890cc1", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature", "dfnText": "policy-controlled feature", "refSections": [{"refs": [{"id": "ref-for-policy-controlled-feature"}], "title": "7.2. Policy-controlled features"}], "external": true};
window.dfnpanelData['86d2a717'] = {"dfnID": "86d2a717", "url": "https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope", "dfnText": "ServiceWorkerGlobalScope", "refSections": [{"refs": [{"id": "ref-for-serviceworkerglobalscope"}], "title": "4.3. Service Worker initialization"}], "external": true};
window.dfnpanelData['36e6e52c'] = {"dfnID": "36e6e52c", "url": "https://www.rfc-editor.org/rfc/rfc8941.html#name-lists", "dfnText": "sf-lists", "refSections": [{"refs": [{"id": "ref-for-name-lists"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-name-lists\u2460"}], "title": "3.3. Critical-CH"}], "external": true};
window.dfnpanelData['959ad97b'] = {"dfnID": "959ad97b", "url": "https://url.spec.whatwg.org/#concept-url-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-url-origin"}, {"id": "ref-for-concept-url-origin\u2460"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-concept-url-origin\u2461"}, {"id": "ref-for-concept-url-origin\u2462"}, {"id": "ref-for-concept-url-origin\u2463"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-concept-url-origin\u2464"}, {"id": "ref-for-concept-url-origin\u2465"}], "title": "3.4. Delegate-CH"}], "external": true};
window.dfnpanelData['client-hints-set'] = {"dfnID": "client-hints-set", "url": "#client-hints-set", "dfnText": "client hints set", "refSections": [{"refs": [{"id": "ref-for-client-hints-set"}, {"id": "ref-for-client-hints-set\u2460"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-client-hints-set\u2461"}], "title": "4.5. Extending environment settings object"}, {"refs": [{"id": "ref-for-client-hints-set\u2462"}], "title": "5. Request processing"}], "external": false};
window.dfnpanelData['accept-ch-cache'] = {"dfnID": "accept-ch-cache", "url": "#accept-ch-cache", "dfnText": "Accept-CH cache", "refSections": [{"refs": [{"id": "ref-for-accept-ch-cache"}, {"id": "ref-for-accept-ch-cache\u2460"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-accept-ch-cache\u2461"}, {"id": "ref-for-accept-ch-cache\u2462"}, {"id": "ref-for-accept-ch-cache\u2463"}, {"id": "ref-for-accept-ch-cache\u2464"}, {"id": "ref-for-accept-ch-cache\u2465"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-accept-ch-cache\u2466"}], "title": "3.4. Delegate-CH"}, {"refs": [{"id": "ref-for-accept-ch-cache\u2467"}], "title": "3.5. Interaction with ACCEPT_CH frame"}], "external": false};
window.dfnpanelData['accept-ch-cache-origin'] = {"dfnID": "accept-ch-cache-origin", "url": "#accept-ch-cache-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-accept-ch-cache-origin"}], "title": "3.2. Accept-CH cache"}], "external": false};
window.dfnpanelData['accept-ch-cache-client-hints-set'] = {"dfnID": "accept-ch-cache-client-hints-set", "url": "#accept-ch-cache-client-hints-set", "dfnText": "client hints set", "refSections": [{"refs": [{"id": "ref-for-accept-ch-cache-client-hints-set"}], "title": "3.2. Accept-CH cache"}], "external": false};
window.dfnpanelData['update-the-client-hints-set-from-cache'] = {"dfnID": "update-the-client-hints-set-from-cache", "url": "#update-the-client-hints-set-from-cache", "dfnText": "update the client hints set from cache", "refSections": [{"refs": [{"id": "ref-for-update-the-client-hints-set-from-cache"}], "title": "3.5. Interaction with ACCEPT_CH frame"}, {"refs": [{"id": "ref-for-update-the-client-hints-set-from-cache\u2460"}], "title": "5. Request processing"}], "external": false};
window.dfnpanelData['abstract-opdef-create-or-override-the-cached-client-hints-set'] = {"dfnID": "abstract-opdef-create-or-override-the-cached-client-hints-set", "url": "#abstract-opdef-create-or-override-the-cached-client-hints-set", "dfnText": "create or override the cached client hints set", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-create-or-override-the-cached-client-hints-set"}], "title": "4.2. Navigation response"}], "external": false};
window.dfnpanelData['abstract-opdef-should-reload-page-for-critical-client-hints'] = {"dfnID": "abstract-opdef-should-reload-page-for-critical-client-hints", "url": "#abstract-opdef-should-reload-page-for-critical-client-hints", "dfnText": "should reload page for critical client hints", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-should-reload-page-for-critical-client-hints"}], "title": "4.2. Navigation response"}], "external": false};
window.dfnpanelData['delegate-ch'] = {"dfnID": "delegate-ch", "url": "#delegate-ch", "dfnText": "Delegate-CH", "refSections": [{"refs": [{"id": "ref-for-delegate-ch"}], "title": "4.4. Standard metadata names"}], "external": false};
window.dfnpanelData['has-reloaded-for-critical-ch'] = {"dfnID": "has-reloaded-for-critical-ch", "url": "#has-reloaded-for-critical-ch", "dfnText": "has reloaded for Critical-CH", "refSections": [{"refs": [{"id": "ref-for-has-reloaded-for-critical-ch"}, {"id": "ref-for-has-reloaded-for-critical-ch\u2460"}], "title": "4.2. Navigation response"}], "external": false};
window.dfnpanelData['environment-settings-object-client-hints-set'] = {"dfnID": "environment-settings-object-client-hints-set", "url": "#environment-settings-object-client-hints-set", "dfnText": "client hints set", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object-client-hints-set"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-environment-settings-object-client-hints-set\u2460"}, {"id": "ref-for-environment-settings-object-client-hints-set\u2461"}], "title": "3.4. Delegate-CH"}, {"refs": [{"id": "ref-for-environment-settings-object-client-hints-set\u2462"}, {"id": "ref-for-environment-settings-object-client-hints-set\u2463"}], "title": "4.3. Service Worker initialization"}, {"refs": [{"id": "ref-for-environment-settings-object-client-hints-set\u2464"}], "title": "5. Request processing"}], "external": false};
window.dfnpanelData['abstract-opdef-append-client-hints-to-request'] = {"dfnID": "abstract-opdef-append-client-hints-to-request", "url": "#abstract-opdef-append-client-hints-to-request", "dfnText": "append client hints to request", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-append-client-hints-to-request"}], "title": "6. Integration with Fetch"}], "external": false};
window.dfnpanelData['abstract-opdef-remove-client-hints-from-redirect-if-needed'] = {"dfnID": "abstract-opdef-remove-client-hints-from-redirect-if-needed", "url": "#abstract-opdef-remove-client-hints-from-redirect-if-needed", "dfnText": "remove client hints from redirect if needed", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-remove-client-hints-from-redirect-if-needed"}], "title": "6. Integration with Fetch"}], "external": false};
window.dfnpanelData['client-hints-token'] = {"dfnID": "client-hints-token", "url": "#client-hints-token", "dfnText": "client hints token", "refSections": [{"refs": [{"id": "ref-for-client-hints-token"}], "title": "3.1. Client hints set"}, {"refs": [{"id": "ref-for-client-hints-token\u2460"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-client-hints-token\u2461"}], "title": "3.3. Critical-CH"}, {"refs": [{"id": "ref-for-client-hints-token\u2462"}, {"id": "ref-for-client-hints-token\u2463"}], "title": "3.4. Delegate-CH"}, {"refs": [{"id": "ref-for-client-hints-token\u2464"}, {"id": "ref-for-client-hints-token\u2465"}, {"id": "ref-for-client-hints-token\u2466"}], "title": "5. Request processing"}], "external": false};
window.dfnpanelData['low-entropy-hint-table'] = {"dfnID": "low-entropy-hint-table", "url": "#low-entropy-hint-table", "dfnText": "low-entropy hint table", "refSections": [{"refs": [{"id": "ref-for-low-entropy-hint-table"}], "title": "5. Request processing"}, {"refs": [{"id": "ref-for-low-entropy-hint-table\u2460"}], "title": "7.3. Low-entropy hint table"}], "external": false};
window.dfnpanelData['find-client-hint-value'] = {"dfnID": "find-client-hint-value", "url": "#find-client-hint-value", "dfnText": "find client hint value", "refSections": [{"refs": [{"id": "ref-for-find-client-hint-value"}], "title": "5. Request processing"}], "external": false};
window.dfnpanelData['field-name'] = {"dfnID": "field-name", "url": "#field-name", "dfnText": "field-name", "refSections": [{"refs": [{"id": "ref-for-field-name"}], "title": "3.2. Accept-CH cache"}, {"refs": [{"id": "ref-for-field-name\u2460"}, {"id": "ref-for-field-name\u2461"}], "title": "3.3. Critical-CH"}], "external": false};</script>
<script>/* script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>